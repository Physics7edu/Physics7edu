<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
  <script src="https://www.glowscript.org/package/glow.3.2.min.js"></script>
  <script src="https://www.glowscript.org/package/RSrun.3.2.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #1f2937;
      color: #f3f4f6;
      font-family: 'Inter', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding: 0;
      margin: 0;
    }
    .container {
      display: flex;
      flex-direction: row;
      flex: 1;
    }
    #canvas-wrapper {
      flex: 1;
      margin-left: 20rem;
      width: calc(100% - 20rem);
      min-height: 300px;
      order: 2;
    }
    #glowscript {
      min-height: 300px;
    }
    #vectorExpr {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      background: rgba(17, 24, 39, 0.95);
      color: #f3f4f6;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-family: 'Courier New', Courier, monospace;
      font-size: 1.25rem;
      z-index: 10;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: opacity 0.3s ease;
    }
    #dotProduct {
      position: absolute;
      top: 4rem;
      right: 1.5rem;
      background: rgba(17, 24, 39, 0.95);
      color: #f3f4f6;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-family: 'Courier New', Courier, monospace;
      font-size: 1rem;
      z-index: 10;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    #error {
      color: #ef4444;
      font-weight: bold;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }
    form {
      position: fixed;
      left: 1rem;
      top: 1rem;
      width: 18rem;
      background: #111827;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 20;
      order: 1;
    }
    input[type="number"], input[type="range"] {
      background: #374151;
      color: #f3f4f6;
      border: 1px solid #4b5563;
      border-radius: 0.25rem;
      padding: 0.4rem;
      transition: all 0.2s ease;
    }
    input[type="number"] {
      width: 4rem;
    }
    input[type="range"] {
      width: 10rem;
      height: 1.5rem;
      -webkit-appearance: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 1.5rem;
      height: 1.5rem;
      background: #6366f1;
      border-radius: 50%;
    }
    input[type="number"]:focus, input[type="range"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    button {
      background-color: #6366f1;
      color: #ffffff;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #4f46e5;
    }
    label {
      color: #d1d5db;
    }
    input[type="checkbox"] {
      accent-color: #6366f1;
      width: 1.2rem;
      height: 1.2rem;
    }
    .toggles {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    @media (max-width: 640px) {
      .container {
        flex-direction: column;
      }
      #canvas-wrapper {
        margin-left: 0;
        width: 100%;
        margin-top: 0; /* Dynamic adjustment handled by JS */
      }
      form {
        position: static;
        width: 100%;
        padding: 1rem;
        margin: 0 auto 1rem auto;
      }
      #vectorExpr, #dotProduct {
        position: static;
        margin: 0.5rem auto;
        width: fit-content;
      }
      input[type="number"] {
        width: 5rem;
      }
      input[type="range"] {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <form>
      <div class="grid grid-cols-1 gap-3">
        <div class="flex items-center space-x-4">
          <label class="w-12">A_x:</label>
          <input type="number" id="Ax" value="3" min="-10" max="10" step="0.1">
          <input type="range" id="sliderAx" min="-10" max="10" step="0.1" value="3">
        </div>
        <div class="flex items-center space-x-4">
          <label class="w-12">A_y:</label>
          <input type="number" id="Ay" value="2" min="-10" max="10" step="0.1">
          <input type="range" id="sliderAy" min="-10" max="10" step="0.1" value="2">
        </div>
        <div class="flex items-center space-x-4">
          <label class="w-12">A_z:</label>
          <input type="number" id="Az" value="1" min="-10" max="10" step="0.1">
          <input type="range" id="sliderAz" min="-10" max="10" step="0.1" value="1">
        </div>
        <div class="flex items-center space-x-4">
          <label class="w-12">B_x:</label>
          <input type="number" id="Bx" value="1" min="-10" max="10" step="0.1">
          <input type="range" id="sliderBx" min="-10" max="10" step="0.1" value="1">
        </div>
        <div class="flex items-center space-x-4">
          <label class="w-12">B_y:</label>
          <input type="number" id="By" value="2" min="-10" max="10" step="0.1">
          <input type="range" id="sliderBy" min="-10" max="10" step="0.1" value="2">
        </div>
        <div class="flex items-center space-x-4">
          <label class="w-12">B_z:</label>
          <input type="number" id="Bz" value="3" min="-10" max="10" step="0.1">
          <input type="range" id="sliderBz" min="-10" max="10" step="0.1" value="3">
        </div>
        <div class="toggles">
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showAx" checked> <span>A_x Component</span>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showAy" checked> <span>A_y Component</span>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showAz" checked> <span>A_z Component</span>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showBx" checked> <span>B_x Component</span>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showBy" checked> <span>B_y Component</span>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="showBz" checked> <span>B_z Component</span>
          </label>
        </div>
        <div id="error"></div>
        <button type="button" onclick="resetScene()" class="mt-3">Reset</button>
      </div>
    </form>
    <div id="canvas-wrapper">
      <div id="glowscript" class="glowscript"></div>
    </div>
  </div>
  <div id="vectorExpr">A = (0.00, 0.00, 0.00), B = (0.00, 0.00, 0.00)</div>
  <div id="dotProduct">A · B = 0.00</div>

  <script type="text/javascript">
  (function(){
    let scene;

    function drawAxes() {
      const L = 6, C = color.white;
      [[L,0,0],[-L,0,0],[0,L,0],[0,-L,0],[0,0,L],[0,0,-L]]
      .forEach(([x,y,z])=>{
        arrow({pos:vec(0,0,0), axis:vec(x,y,z), color:C, shaftwidth:0.05});
      });
      label({pos:vec(L+0.3,0,0), text:"X", box:false, color:C});
      label({pos:vec(-L-0.6,0,0), text:"X′", box:false, color:C});
      label({pos:vec(0,L+0.3,0), text:"Y", box:false, color:C});
      label({pos:vec(0,-L-0.6,0), text:"Y′", box:false, color:C});
      label({pos:vec(0,0,L+0.3), text:"Z", box:false, color:C});
      label({pos:vec(0,0,-L-0.6), text:"Z′", box:false, color:C});
    }

    function updateVectorExpr(A, B) {
      $("#vectorExpr").text(
        `A = (${A.x.toFixed(2)}, ${A.y.toFixed(2)}, ${A.z.toFixed(2)}), ` +
        `B = (${B.x.toFixed(2)}, ${B.y.toFixed(2)}, ${B.z.toFixed(2)})`
      );
    }

    function drawScene() {
      $("#error").text("");
      $("#dotProduct").text("");

      const A = vec(+$("#Ax").val(), +$("#Ay").val(), +$("#Az").val());
      const B = vec(+$("#Bx").val(), +$("#By").val(), +$("#Bz").val());
      const dot = A.dot(B);
      $("#dotProduct").text(`A · B = ${A.x.toFixed(2)} × ${B.x.toFixed(2)} + ` +
                            `${A.y.toFixed(2)} × ${B.y.toFixed(2)} + ` +
                            `${A.z.toFixed(2)} × ${B.z.toFixed(2)} = ${dot.toFixed(2)}`);

      updateVectorExpr(A, B);

      scene.objects.forEach(o => o.visible = false);
      scene.objects.length = 0;

      drawAxes();

      arrow({pos:vec(0,0,0), axis:A, color:color.magenta, shaftwidth:0.1});
      sphere({pos:A, radius:0.15, color:color.red});
      label({
        pos:A.add(vec(0.3,0.3,0.3)),
        text:`A(${A.x.toFixed(2)},${A.y.toFixed(2)},${A.z.toFixed(2)})`,
        color:color.white, box:false, height:12
      });

      arrow({pos:vec(0,0,0), axis:B, color:color.cyan, shaftwidth:0.1});
      sphere({pos:B, radius:0.15, color:color.blue});
      label({
        pos:B.add(vec(0.3,0.3,0.3)),
        text:`B(${B.x.toFixed(2)},${B.y.toFixed(2)},${B.z.toFixed(2)})`,
        color:color.white, box:false, height:12
      });

      const components = [
        [A.x, vec(A.x,0,0), color.red, "showAx"],
        [A.y, vec(0,A.y,0), color.green, "showAy"],
        [A.z, vec(0,0,A.z), color.blue, "showAz"],
        [B.x, vec(B.x,0,0), color.red, "showBx"],
        [B.y, vec(0,B.y,0), color.green, "showBy"],
        [B.z, vec(0,0,B.z), color.blue, "showBz"]
      ];
      components.forEach(([comp, dir, col, checkboxId]) => {
        if ($("#"+checkboxId).prop("checked") && comp !== 0) {
          arrow({pos:vec(0,0,0), axis:dir, color:col, shaftwidth:0.08});
          label({
            pos:dir.multiply(0.5).add(vec(0.2,0.2,0.2)),
            text:comp.toFixed(2),
            color:col,
            box:false, height:12
          });
        }
      });
    }

    function adjustCanvasMargin() {
      const isMobile = window.innerWidth <= 640;
      if (isMobile) {
        const formHeight = Math.max($("form").outerHeight(), 300); // Fallback height
        $("#canvas-wrapper").css("margin-top", `${formHeight + 50}px`);
      } else {
        $("#canvas-wrapper").css("margin-top", "0");
      }
    }

    function setup() {
      // Initial adjustment with delay
      setTimeout(() => {
        adjustCanvasMargin();
        const isMobile = window.innerWidth <= 640;
        scene = canvas({
          width: isMobile ? 400 : 800,
          height: isMobile ? 300 : 600,
          background: color.black,
          center: vec(0,0,0),
          forward: vec(-1,-1,-1)
        });

        // Bind input and checkbox events
        [["Ax","sliderAx"],["Ay","sliderAy"],["Az","sliderAz"],
         ["Bx","sliderBx"],["By","sliderBy"],["Bz","sliderBz"]]
        .forEach(([n,s])=>{
          $("#"+n).on("input", ()=>{
            $("#"+s).val($("#"+n).val());
            drawScene();
          });
          $("#"+s).on("input", ()=>{
            $("#"+n).val($("#"+s).val());
            drawScene();
          });
        });
        ["showAx","showAy","showAz","showBx","showBy","showBz"].forEach(id=>{
          $("#"+id).on("change", drawScene);
        });

        drawScene();
      }, 200); // Increased delay to 200ms

      // Adjust margin on window resize
      $(window).on("resize", adjustCanvasMargin);
    }

    window.resetScene = ()=>{
      $("#Ax, #sliderAx").val(3);
      $("#Ay, #sliderAy").val(2);
      $("#Az, #sliderAz").val(1);
      $("#Bx, #sliderBx").val(1);
      $("#By, #sliderBy").val(2);
      $("#Bz, #sliderBz").val(3);
      ["showAx","showAy","showAz","showBx","showBy","showBz"].forEach(id=>{
        $("#"+id).prop("checked", true);
      });
      drawScene();
    };

    window.__context = { glowscript_container: $("#glowscript").removeAttr("id") };
    window.onload = setup;
  })();
  </script>
</body>
</html>